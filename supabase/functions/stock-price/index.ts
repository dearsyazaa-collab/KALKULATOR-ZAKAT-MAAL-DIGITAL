import { serve } from "https://deno.land/std@0.192.0/http/server.ts"; serve(async (req) => {   try {     const { stock } = await req.json();     if (!stock) {       return new Response(         JSON.stringify({ error: "STOCK_CODE_REQUIRED" }),         { status: 400 }       );     }     const symbol = `${stock}.JK`;     const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1d`;     const yahooRes = await fetch(url, {       headers: {         "User-Agent": "Mozilla/5.0"       }     });     if (!yahooRes.ok) {       return new Response(         JSON.stringify({ error: "YAHOO_FETCH_FAILED" }),         { status: 500 }       );     }     const json = await yahooRes.json();     const price = json?.chart?.result?.[0]?.meta?.regularMarketPrice;     if (!price || isNaN(price)) {       return new Response(         JSON.stringify({ error: "PRICE_NOT_FOUND" }),         { status: 404 }       );     }     return new Response(       JSON.stringify({         stock,         price: Math.round(price)       }),       {         headers: {           "Content-Type": "application/json"         }       }     );   } catch (e) {     return new Response(       JSON.stringify({ error: "INTERNAL_ERROR", detail: e.message }),       { status: 500 }     );   } }); 
